def sendslackNotification(String buildStatus = 'STARTED') {
  // build status of null means successful
  buildStatus =  buildStatus ?: 'SUCCESSFUL'

  // Default values
  def colorName = 'RED'
  def colorCode = '#FF0000'
  def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
  def summary = "${subject} (${env.BUILD_URL})"

  // Override default values based on build status
  if (buildStatus == 'STARTED') {
    color = 'YELLOW'
    colorCode = '#FFFF00'
  } else if (buildStatus == 'SUCCESSFUL') {
    color = 'GREEN'
    colorCode = '#00FF00'
  } else {
    color = 'RED'
    colorCode = '#FF0000'
  }

  // Send notifications
  slackSend (color: colorCode, message: summary)
}
node {
try {
  sendslackNotification('STARTED')
 
  def mavenHome = tool name: "maven3.9.6"
  def mavenCmd = "${mavenHome}/bin/mvn"
  properties([buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')), [$class: 'JobLocalConfiguration', changeReasonComment: ''], pipelineTriggers([pollSCM('* * * * *')])])
  stage ('checkoutcode')
  {
    git branch: 'development', credentialsId: '0913d18f-e377-4ec0-9f08-2c00fc16b45d', url: 'https://github.com/predconstructions/maven-web-application.git'
  }
  stage ('build Package')
  {
    sh "${mavenCmd} clean package"
  }
  stage ('upload artifacts into nexus')
  {
    sh "${mavenCmd} deploy"
  }
  stage ('deploy into tomcat server')
  {
  sshagent(['49ed8f25-df06-498b-a010-5d98f54360f0']) {
    sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@65.2.121.116:/opt/apache-tomcat-9.0.86/webapps"
  }    
  } catch(e) {
    CurrentBuild.result="FAILED"
      throw e
}
}
finally{
sendslackNotification(CurrentBuild.result)
}
}
